# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on PR
on: pull_request
jobs:
  build_and_preview:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '14'
      - uses: actions/cache@v2
        with:
          path: ~/.npm
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-
      - name: Create environment file
        env:
          OPEN_WEATHER_API_ID: '${{ secrets.OPEN_WEATHER_API_ID }}'
          SENTRY_DSN: '${{ secrets.SENTRY_DSN }}'
          FIREBASE_API_KEY: '${{ secrets.FIREBASE_API_KEY }}'
          FIREBASE_MESSAGING_SENDER_ID: '${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}'
          FIREBASE_APP_ID: '${{ secrets.FIREBASE_APP_ID }}'
          FIREBASE_MEASUREMENT_ID: '${{ secrets.FIREBASE_MEASUREMENT_ID }}'
        run: |
          touch .env
          echo "REACT_APP_OPEN_WEATHER_API_ID=$OPEN_WEATHER_API_ID" >> .env
          echo "REACT_APP_ENVIRONMENT=Beta" >> .env
          echo "REACT_APP_SENTRY_DSN=$SENTRY_DSN" >> .env
          echo "REACT_APP_API_KEY=$FIREBASE_API_KEY" >> .env
          echo "REACT_APP_AUTH_DOMAIN=weather-caddy.firebaseapp.com" >> .env
          echo "REACT_APP_DATABASE_URL=https://weather-caddy.firebaseio.com" >> .env
          echo "REACT_APP_PROJECT_ID=weather-caddy" >> .env
          echo "REACT_APP_STORAGE_BUCKET=weather-caddy.appspot.com" >> .env
          echo "REACT_APP_MESSAGING_SENDER_ID=$FIREBASE_MESSAGING_SENDER_ID" >> .env
          echo "REACT_APP_APP_ID=$FIREBASE_APP_ID" >> .env
          echo "REACT_APP_MEASUREMENT_ID=$FIREBASE_MEASUREMENT_ID" >> .env
      - run: npm ci
      - run: npm run prettier
      - run: npm run build
      - name: Run Tests
        run: npm test -- --watchAll=false
